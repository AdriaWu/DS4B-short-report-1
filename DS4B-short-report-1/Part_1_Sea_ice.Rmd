---
title: "Part_1_Sea_ice"
author: "Heyue WU_u7628175"
date: "15/09/2023"
output:  
    html_document:
        toc: true
        toc_depth: 4
        theme: cosmo
        number_sections: false
        toc_float: true
        highlight: pygments
        fig_width: 8
        fig_height: 4
---

# Location on GitHub

https://github.com/AdriaWu/DS4B-short-report-1//blob/main/DS4B-short-report-1/Part_1_Sea_ice.Rmd

# 1. Loading the data_1 and preparing for the packages

```{r}
# Load necessary R packages
library(tidyverse)
library(ggplot2)
library(readxl)
library(dplyr)
library(lubridate)

# Read data from Excel file
data_1 <- read_csv("raw_data/S_seaice_extent_daily_v3.0.csv")

# have a quick view of the data
tibble(data_1)

# Check the type of value
summary(data_1)
```

# 2. Data Transformation

```{r}
# Delete the second row of data
data_1 <- data_1 |>
  slice(-1)

# Transform the Extent column to numbers
data_1$Extent <- as.numeric(as.character(data_1$Extent))

# Check the tidy_data
tibble(data_1)
```

# 3. Filter data and evaluate by year or month

```{r}
# Filter out the data for winter
winter_data <- data_1 |>
  filter(Month %in% c(6, 7, 8))

Jun_df<- winter_data |>
  filter(Month == 6) |>
  group_by(Year) |>
  summarise(
    Mean_Jun_Extent = mean(Extent, na.rm = TRUE)
    )

July_df <- winter_data |>
  filter(Month == 7) |>
  group_by(Year) |>
  summarise(
    Mean_July_Extent = mean(Extent, na.rm = TRUE)
    )

Aug_df <- winter_data |>
  filter(Month == 8) |>
  group_by(Year) |>
  summarise(
    Mean_Aug_Extent = mean(Extent, na.rm = TRUE)
    )

Year_df <- winter_data |>
  group_by(Year) |>
  summarise(
    Min_Winter_Extent = min(Extent, na.rm = TRUE),
    Mean_Winter_Extent = mean(Extent, na.rm = TRUE),
    .groups = "drop"
  )

# 合并数据框
# 合并Jun_df和July_df
merged_df <- left_join(Jun_df, July_df, by = "Year")

# 合并merged_df和Aug_df
merged_df <- left_join(merged_df, Aug_df, by = "Year")

# 合并merged_df和Year_df
final_df <- left_join(merged_df, Year_df, by = "Year")

print(Jun_df)
print(July_df)
print(Aug_df)
print(Year_df)
print(final_df)

```
```{r}

```


```{r}
plot_1 <- ggplot(tidy_data, aes(x = Date, y = Extent)) +
  
```


# 5. 使用ggplot绘制时间序列图
plot <- ggplot(tidy_data, aes(x = Date, y = Extent)) +
  geom_line(aes(color = ifelse(Date %in% winter_2023$Date, "Winter 2023", "Other years")), linewidth = 1) +
  geom_hline(yintercept = mean(data_1$Extent, na.rm = TRUE), linetype = "dashed", color = "red", linewidth = 1) +
  annotate("text", x = min(data_1$Date), y = mean(data$Extent, na.rm = TRUE), label = "Average Extent", vjust = -1) +
  labs(title = "过去几年的南极海冰范围",
       x = "Year",
       y = "Extent (10^6 sq km)",
       color = "Year") +
  theme_test() +
  theme(legend.position = "bottom",
        text = element_text(size = 14),
        plot.title = element_text(hjust = 0.5, size = 20)) +
  scale_color_manual(values = c("Winter 2023" = "blue", "Other years" = "grey50"))

print(plot)

```

```{r}
# 选择近5年的数据
recent_data <- data %>%
  filter(Year >= 2018)

# 绘制图表
plot <- ggplot(recent_data, aes(x = Date, y = Extent)) +
  geom_smooth(aes(color = ifelse(Date %in% winter_2023$Date, "Winter 2023", "Other years")), se = FALSE) +
  geom_hline(yintercept = mean(recent_data$Extent, na.rm = TRUE), linetype = "dashed", color = "red", size = 1) +
  annotate("text", x = min(recent_data$Date), y = mean(recent_data$Extent, na.rm = TRUE) + 0.5, label = "Average Extent", vjust = -1) +
  labs(title = "过去几年的南极海冰范围",
       x = "Year",
       y = "Extent (10^6 sq km)",
       color = "Year") +
  theme_test() +
  theme(legend.position = "bottom",
        text = element_text(size = 14),
        plot.title = element_text(hjust = 0.5, size = 20)) +
  scale_color_manual(values = c("Winter 2023" = "blue", "Other years" = "grey50"))

# 显示图形
plot

```


```{r}
# 加载必要的库
library(ggplot2)
library(dplyr)
library(readxl)

# 创建日期列
data$DateString <- sprintf("%04d-%02d-%02d", as.numeric(data$Year), as.numeric(data$Month), as.numeric(data$Day))

# 过滤掉问题日期
data <- data[data$DateString != "NA-NA-NA", ]

# 再次尝试创建日期列
data$Date <- as.Date(data$DateString, format="%Y-%m-%d")

# 按年和月分组并计算每月的平均海冰范围
monthly_avg <- data %>%
  group_by(Year, Month) %>%
  summarise(AvgExtent = mean(Extent, na.rm = TRUE))

# 绘制时间序列图
plot <- ggplot(monthly_avg, aes(x = as.Date(paste0(Year, "-", sprintf("%02d", Month), "-01")), y = AvgExtent)) +
  geom_line(aes(color = ifelse(Year == 2023 & Month %in% c(6, 7, 8), "Winter 2023", "Other years")), size = 1) +
  geom_hline(yintercept = mean(monthly_avg$AvgExtent, na.rm = TRUE), linetype = "dashed", color = "red", size = 1) +
  annotate("text", x = min(monthly_avg$Date), y = mean(monthly_avg$AvgExtent, na.rm = TRUE) + 0.5, label = "Average Extent", vjust = -1) +
  labs(title = "过去几年的南极海冰范围",
       x = "Year",
       y = "Extent (10^6 sq km)",
       color = "Year") +
  theme_minimal() +
  theme(legend.position = "bottom",
        text = element_text(size = 14),
        plot.title = element_text(hjust = 0.5, size = 20)) +
  scale_color_manual(values = c("Winter 2023" = "blue", "Other years" = "grey50"))

plot

```




