---
title: "Part_2_Frog_Species"
author: "Heyue WU_u7628175"
date: "15/09/2023"
output:  
    html_document:
        toc: true
        toc_depth: 4
        theme: cosmo
        number_sections: false
        toc_float: true
        highlight: pygments
        fig_width: 8
        fig_height: 4
---

# Location on GitHub

https://github.com/AdriaWu/DS4B-short-report-1//blob/main/DS4B-short-report-1/Part_2_Frog_Species.Rmd

# 1. Loading the data

```{r}
# Load necessary R packages
library(tidyverse)
library(ggplot2)
library(readxl)
library(dplyr)
library(lubridate)

# Read data from Excel file
data_2 <- read_csv("raw_data/FrogID4_final_dataset.csv")

# have a quick view of the data
tibble(data_2)

# Check the type of value
summary(data_2)
```

# 2. Data Cleaning and Preliminary Analysis

The next step is to identify any anomalies, inconsistencies, or missing values.

```{r}
# Check for missing values and use the `summarise_all()` to summarize or calculate all columns in a data frame
data_2 |>
  summarise_all(~sum(is.na(.)))
```
This means that all rows of these columns have valid data, with no missing values. Then let's check for duplicates.

```{r}
# use the `duplicated()` function to identify and count duplicate rows.
sum(duplicated(data_2))
```
So there are no duplicate rows in the data_2. 

Before diving into any analysis or visualization, we can make a summary of the dataset to provide a quick snapshot of key features for the data, which might help the readers who are unfamiliar with the dataset.

```{r}
# Number of unique species
unique_species <- length(unique(data_2$scientificName))

# Get range of dates

# The original date data is in character format, and we can just find the start date and end date.
start_Date <- as.character(min(data_2$eventDate))
end_Date <- as.character(max(data_2$eventDate))

# Distribution of recordings across states
state_distribution <- table(data_2$stateProvince)

# Print the summary
cat("Summary of the Dataset:\n")
cat("-----------------------\n")
cat("Number of Unique Species Recorded:", unique_species, "\n")
cat("Range of Dates: From", start_Date, "to", end_Date, "\n")
cat("Distribution of Recordings Across States:\n")
print(state_distribution)
```
We can know that the dataset has recorded a total of 199 unique species. The recordings span from the date 2017-11-10 to 2021-11-09. And with 229,000 recordings, NSW dominates the dataset, accounting for a significant portion of the total recordings.

# 3. Plot the species discovery curve for Australia

### 3.1. Plot the species discovery curve for the whole of Australia

After a preliminary analysis of the data, we can plot the species discovery curve for Australia as a whole. This will show the cumulative number of species discovered over time.

```{r}
# Convert the `eventDate` column into standardized Date objects and create a new column to store them, ensuring consistency across the dataset and better visualization later.
data_2$Date_Object <- as.Date(data_2$eventDate, format="%Y/%m/%d")

# Sort the data by date
data_sorted <- data_2 |>
  arrange(Date_Object) |>
  group_by(Date_Object) |>
  # Count the number of unique species on each date and then summarize them.
  summarise(unique_species = n_distinct(scientificName)) |>
  # Create a new column representing the cumulative number of species discovered so far, which includes the number of species on all previous dates.
  mutate(cumulative_species = cumsum(unique_species))

# Use ggplot2 to plot the species discovery curve for Australia as whole
plot_1 <- ggplot(data_sorted, aes(x = Date_Object, y = cumulative_species)) +
  geom_line(color = "#2E86C1", linewidth = 1) +
  
  labs(title = "Species Discovery Curve for Australia",
       x = "Date",
       y = "Cumulative Number of Species Discovered") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.title.y = element_text(size = 14, face = "bold"),
    axis.text.x = element_text(size = 12),
    axis.text.y = element_text(size = 12),
    panel.grid.minor = element_line(color = "gray90"),
    panel.grid.major = element_line(color = "gray80")
    ) 

# Extract the first and last dates of the data_sorted 
first_date <- data_sorted[1, ]
last_date <- data_sorted[nrow(data_sorted), ]

# Add points and date labels
plot_1 <- plot_1 +
  geom_point(data = first_date, aes(x = Date_Object, y = cumulative_species), color = "#E74C3C", size = 3) +
  geom_point(data = last_date, aes(x = Date_Object, y = cumulative_species), color = "#E74C3C", size = 3) +
  geom_text(data = first_date, 
            aes(x = Date_Object, 
                y = cumulative_species,
                label = start_Date), 
            vjust = -3, 
            hjust = 0.25, 
            size = 3, 
            color = "#E74C3C") +
  geom_text(data = last_date, 
            aes(x = Date_Object, 
                y = cumulative_species, 
                label = end_Date), 
            vjust = 1.5, 
            hjust = 1.25, 
            size = 3, 
            color = "#E74C3C")

print(plot_1)

```
From plot_1, we can see that by the date 2021-11-09, the cumulative number of species discovered has already exceeded 45,000.

### 3.2. Plot the data for each state and territory

Next, let's break down the data to show the same relationship for each state and territory. For the state-wise breakdown, use different colors or line types to represent each state on the same plot. This will allow for easy comparison and identification of states with higher species diversity or more active recording.

```{r}
# Sort and group data by date and state
data_sorted_statewise <- data_2 |>
  arrange(Date_Object) |>
  # This line of code is different from the code in the plot_1
  group_by(Date_Object, stateProvince) |>
  summarise(unique_species = n_distinct(scientificName), .groups = "drop") |>
  group_by(stateProvince) |>
  mutate(cumulative_species = cumsum(unique_species))

# Plot the species discovery curve for each state
plot_2 <- ggplot(data_sorted_statewise, 
                 aes(x = Date_Object, 
                     y = cumulative_species, 
                     color = stateProvince)) +
  geom_line() +
  scale_color_brewer(palette = "Set1") +
  labs(title = "Species Discovery Curve by State in Australia",
       x = "Date",
       y = "Cumulative Number of Species Discovered",
       color = "State/Territory") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.title.y = element_text(size = 12, face = "bold"),
    axis.text.x = element_text(size = 10),
    axis.text.y = element_text(size = 10),
    legend.position = "bottom",
    legend.title = element_text(size = 14, face = "bold"),
    legend.text = element_text(size = 10)
  )
  
print(plot_2)
```

This plot show separate trends for each state and territory, allowing for a comparison between them. We can find that here displays a consistent trend in the data. Over time, NSW and QLD have exhibited the most significant growth in the number of species discoveries. Concurrently, the growth trends in species discoveries for WA, VIC, and NT have been relatively consistent with each other. SA, TAS, and ACT have similarly shown comparable growth patterns, while other territories have remained stable with no evident increase in species discoveries.

# 4. Estimation of True Number of Frog Species

Now we need to estimate the true number of frog species in Australia in two ways. One is the extrapolation emthod, and another is the chang01 method.

### 4.1. Extrapolation Method

We can fit a curve (e.g., logistic growth curve) to the Australia-wide species discovery data. Extrapolate this curve to estimate when it levels off, indicating the potential total number of species.

The logistic growth curve is defined by the equation:

$$
N(t) = \frac{K}{1 + \frac{K - N_0}{N_0} e^{-rt}}
$$

Where:
- $N(t)$ is the number of species discovered up to time $t$.
- $K$ is the carrying capacity, or the total number of species.
- $r$ is the growth rate.
- $N_0$ is the initial number of species at $t = 0$.

